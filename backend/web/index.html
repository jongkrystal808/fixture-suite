<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/web/favicon.ico" type="image/x-icon">
  <title>治具管理系統</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    button { border: 1px solid #D1D5DB; border-radius: 0.75rem; background:#fff; cursor:pointer; }
    .card { background:#fff; border:1px solid #E5E7EB; border-radius:1rem; box-shadow:0 1px 2px rgba(0,0,0,0.04); }
    .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .75rem; font-size:.875rem; font-weight:500; line-height:1.25rem; }
    .btn-primary { background:#111827; color:#fff; border-color:#111827; }
    .btn-ghost { background:#fff; color:#111827; border-color:#D1D5DB; }
    .pill { display:inline-block; font-size:.75rem; padding:.125rem .5rem; border-radius:9999px; border:1px solid #D1D5DB; }
    .tab { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .75rem; font-size:.875rem; font-weight:500; line-height:1.25rem; background:#fff; border:1px solid #D1D5DB; border-radius:.75rem; transition:all .15s ease; }
    .tab:hover { background:#F9FAFB; }
    .tab-active { background:#111827; color:#fff; border-color:#111827; font-weight:700; box-shadow:0 0 0 2px rgba(17,24,39,0.25) inset; }
    .section-title { font-size:1rem; font-weight:600; letter-spacing:.02em; }
    .subtab { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .75rem; font-size:.875rem; font-weight:500; line-height:1.25rem; background:#fff; border:1px solid #D1D5DB; border-radius:.75rem; transition:all .15s ease; }
    .subtab-active { background:#111827; color:#fff; border-color:#111827; font-weight:700; }
    .field { display:flex; flex-direction:column; gap:.25rem; }
    .label-xs { font-size:.75rem; color:#6B7280; }
    .input { border:1px solid #D1D5DB; border-radius:.75rem; padding:.5rem .75rem; }
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal { background:#fff; border-radius:1rem; width:100%; max-width:24rem; padding:1.25rem; border:1px solid #E5E7EB; }
    .pagination button[disabled] { opacity:.5; cursor:not-allowed; }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .warning-tag { background: #FEF3C7; color: #92400E; border: 1px solid #FCD34D; }
    .danger-tag { background: #FEE2E2; color: #991B1B; border: 1px solid #FCA5A5; }
  </style>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- 登入介面 -->
  <div id="loginModal" class="modal-backdrop">
    <div class="modal space-y-4">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-lg">登入</h3>
        <button class="btn btn-ghost text-xs" onclick="closeLogin()">關閉</button>
      </div>
      <div class="grid gap-3">
        <div class="field"><label class="label-xs">帳號</label><input id="loginId" class="input" placeholder="輸入帳號"/></div>
        <div class="field"><label class="label-xs">密碼</label><input id="loginPwd" type="password" class="input" placeholder="輸入密碼"/></div>
        <button class="btn btn-primary" onclick="mockLogin()">登入</button>
        <p id="loginMsg" class="text-xs text-gray-500"></p>
      </div>
    </div>
  </div>

  <!-- 頂部導覽 -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-8 rounded-xl bg-gray-900 text-white grid place-items-center font-bold">F</div>
        <div>
          <h1 class="text-lg font-semibold leading-tight">治具管理系統</h1>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <span class="pill border-gray-300" id="clock">--:--</span>
        <span id="loginState" class="text-xs text-gray-600">未登入</span>
        <button class="btn btn-ghost" id="btnLogin" onclick="openLogin()">登入</button>
      </div>
    </div>
  </header>

  <!-- 主容器 -->
  <main class="mx-auto max-w-7xl p-4 md:p-6 space-y-6">
    <!-- 功能分頁 -->
    <nav class="grid grid-cols-2 md:grid-cols-7 gap-2">
      <button data-tab="dashboard" class="tab tab-active">儀表板</button>
      <button data-tab="receive"  class="tab">收料登記</button>
      <button data-tab="return"   class="tab">退料登記</button>
      <button data-tab="query"    class="tab">治具/機種查詢</button>
      <button data-tab="stats"    class="tab">治具情況統計</button>
      <button data-tab="logs"     class="tab">使用/更換記錄</button>
      <button data-tab="admin"    class="tab">後台管理</button>
    </nav>

    <!-- 當前切頁標題欄 -->
    <div id="activeTabBanner" class="card px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-1.5 rounded-full bg-gray-900"></div>
        <div class="section-title" id="activeTabTitle">儀表板</div>
      </div>
    </div>

    <!-- 儀表板 -->
    <section id="tab-dashboard" class="space-y-6">
      <div class="card p-4">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">快速連結</h3>
          <button class="btn btn-ghost text-xs" onclick="openLogin()">開啟登入介面</button>
        </div>
      </div>
      <div class="grid md:grid-cols-3 gap-4">
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">今日收料</h3>
            <span class="pill border-green-300 text-green-700 bg-green-50">即時</span>
          </div>
          <p class="text-3xl font-bold mt-2" id="todayIn">0</p>
          <div class="mt-3 space-y-2" id="todayInList"></div>
        </div>
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">今日退料</h3>
            <span class="pill border-blue-300 text-blue-700 bg-blue-50">即時</span>
          </div>
          <p class="text-3xl font-bold mt-2" id="todayOut">0</p>
          <div class="mt-3 space-y-2" id="todayOutList"></div>
        </div>
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">即將更換治具</h3>
            <button class="btn btn-ghost text-xs" onclick="downloadCSV('upcoming.csv', mockUpcomingCSV())">匯出</button>
          </div>
          <div class="mt-3 space-y-2 max-h-40 overflow-auto" id="upcomingList"></div>
        </div>
      </div>

      <div class="card p-5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold">庫存概覽</h3>
          <div class="flex items-center gap-2">
            <input id="searchDash" class="w-48 border rounded-xl px-3 py-1.5 text-sm" placeholder="搜尋治具/機種..." />
            <button class="btn btn-ghost text-sm" onclick="filterDashboard()">篩選</button>
          </div>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">治具編號</th>
                <th class="py-2 pr-4">名稱</th>
                <th class="py-2 pr-4">機種</th>
                <th class="py-2 pr-4">儲位</th>
                <th class="py-2 pr-4">狀態</th>
                <th class="py-2 pr-4">使用次數/週期</th>
                <th class="py-2 pr-4">負責人</th>
              </tr>
            </thead>
            <tbody id="dashTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 收料登記 -->
    <section id="tab-receive" class="hidden space-y-4">
      <div class="card p-5 space-y-4">
        <h3 class="font-semibold">收料表單</h3>
        <div class="grid md:grid-cols-5 gap-3">
          <div class="field"><label class="label-xs">治具</label><input id="rcvFixture" class="input" placeholder="例如:JIG-001 或自由輸入" /></div>
          <div class="field"><label class="label-xs">LOT No.</label><input id="rcvLot" class="input" placeholder="例如: L240915A" /></div>
          <div class="field"><label class="label-xs">數量</label><input id="rcvQty" type="number" class="input" placeholder="0" /></div>
          <div class="field"><label class="label-xs">日期時間</label><input id="rcvDate" type="datetime-local" class="input" /></div>
          <div class="flex items-end"><button class="btn btn-primary w-full" onclick="addReceipt()">確認收料</button></div>
        </div>
        <div class="flex items-center gap-2 pt-2">
          <label class="btn btn-ghost cursor-pointer">
            <input id="rcvCsv" type="file" accept=".xlsx,.csv" class="hidden" onchange="handleReceiptCsv(this)" /> 匯入 Excel/CSV
          </label>
          <button class="btn btn-ghost" onclick="downloadCSV('receipts_template.csv', sampleTemplateCSV('receipt'))">下載範本</button>
          <div class="ml-auto flex items-center gap-2">
            <input id="rcvSearch" class="w-56 input text-sm" placeholder="搜尋(治具/LOT)" oninput="renderReceipts()" />
            <span class="text-xs text-gray-500">共 <span id="rcvCount">0</span> 筆</span>
          </div>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr><th class="py-2 pr-4">日期時間</th><th class="py-2 pr-4">治具</th><th class="py-2 pr-4">LOT</th><th class="py-2 pr-4">數量</th><th class="py-2 pr-4">操作</th></tr>
            </thead>
            <tbody id="rcvTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 退料登記 -->
    <section id="tab-return" class="hidden space-y-4">
      <div class="card p-5 space-y-4">
        <h3 class="font-semibold">退料表單</h3>
        <div class="grid md:grid-cols-5 gap-3">
          <div class="field"><label class="label-xs">治具</label><input id="retFixture" class="input" placeholder="例如:JIG-001 或自由輸入" /></div>
          <div class="field"><label class="label-xs">LOT No.</label><input id="retLot" class="input" placeholder="例如: L240915A" /></div>
          <div class="field"><label class="label-xs">數量(不可大於收料總量)</label><input id="retQty" type="number" class="input" placeholder="0" /></div>
          <div class="field"><label class="label-xs">日期時間</label><input id="retDate" type="datetime-local" class="input" /></div>
          <div class="flex items-end"><button class="btn btn-primary w-full" onclick="addReturn()">確認退料</button></div>
        </div>
        <div class="flex items-center gap-2 pt-2">
          <label class="btn btn-ghost cursor-pointer"><input id="retCsv" type="file" accept=".xlsx,.csv" class="hidden" onchange="handleReturnCsv(this)" /> 匯入 Excel/CSV</label>
          <button class="btn btn-ghost" onclick="downloadCSV('returns_template.csv', sampleTemplateCSV('return'))">下載範本</button>
          <div class="ml-auto flex items-center gap-2">
            <input id="retSearch" class="w-56 input text-sm" placeholder="搜尋(治具/LOT)" oninput="renderReturns()" />
            <span class="text-xs text-gray-500">共 <span id="retCount">0</span> 筆</span>
          </div>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr><th class="py-2 pr-4">日期時間</th><th class="py-2 pr-4">治具</th><th class="py-2 pr-4">LOT</th><th class="py-2 pr-4">數量</th><th class="py-2 pr-4">操作</th></tr>
            </thead>
            <tbody id="retTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 查詢 -->
    <section id="tab-query" class="hidden space-y-4">
      <div class="card p-5 space-y-4">
        <div class="grid md:grid-cols-5 gap-3">
          <div class="field"><label class="label-xs">治具名稱</label><input id="qFixture" class="input" placeholder="如:JIG-001" /></div>
          <div class="field"><label class="label-xs">機種</label><select id="qModel" class="input"><option value="">全部</option></select></div>
          <div class="field"><label class="label-xs">位置/儲位</label><input id="qLoc" class="input" placeholder="如:A-01-03" /></div>
          <div class="field"><label class="label-xs">負責人</label><select id="qOwner" class="input"></select></div>
          <div class="flex items-end gap-2"><button class="btn btn-primary w-full" onclick="applyQuery()">查詢</button></div>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr><th class="py-2 pr-4">圖片</th><th class="py-2 pr-4">治具</th><th class="py-2 pr-4">機種</th><th class="py-2 pr-4">儲位</th><th class="py-2 pr-4">最大開站量</th><th class="py-2 pr-4">狀態</th><th class="py-2 pr-4">操作</th></tr>
            </thead>
            <tbody id="queryTable"></tbody>
          </table>
        </div>
        <div class="flex justify-end gap-2">
          <button class="btn btn-ghost" onclick="downloadCSV('fixtures_query.csv', toCSV(mockFixtures))">匯出查詢結果</button>
        </div>
      </div>
    </section>

    <!-- 治具情況統計(新增分頁) -->
    <section id="tab-stats" class="hidden space-y-4">
      <!-- 統計卡片 -->
      <div class="grid md:grid-cols-4 gap-4">
        <div class="card p-5 stat-card">
          <div class="text-sm opacity-90">總治具數量</div>
          <div class="text-3xl font-bold mt-2" id="statTotalFixtures">0</div>
        </div>
        <div class="card p-5 bg-gradient-to-br from-green-400 to-emerald-600 text-white">
          <div class="text-sm opacity-90">正常使用中</div>
          <div class="text-3xl font-bold mt-2" id="statActiveFixtures">0</div>
        </div>
        <div class="card p-5 bg-gradient-to-br from-amber-400 to-orange-600 text-white">
          <div class="text-sm opacity-90">壽命未達標</div>
          <div class="text-3xl font-bold mt-2" id="statUnderLifespan">0</div>
        </div>
        <div class="card p-5 bg-gradient-to-br from-red-400 to-rose-600 text-white">
          <div class="text-sm opacity-90">即將更換</div>
          <div class="text-3xl font-bold mt-2" id="statNeedReplacement">0</div>
        </div>
      </div>

      <!-- 治具壽命管理作法 -->
      <div class="card p-5 space-y-4">
        <h3 class="font-semibold text-lg">治具壽命管理作法(針對不耐用治具)</h3>

        <div class="grid md:grid-cols-2 gap-4">
          <!-- 1. 建立壽命比對機制 -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-blue-100 text-blue-700 grid place-items-center font-bold">1</div>
              <h4 class="font-semibold">建立壽命比對機制</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>• 每個治具設定預期壽命(次數或天數)</li>
              <li>• 系統記錄實際使用次數</li>
              <li>• 未達標自動標示「壽命未達預設值」</li>
            </ul>
          </div>

          <!-- 2. 自動分類與標示 -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-green-100 text-green-700 grid place-items-center font-bold">2</div>
              <h4 class="font-semibold">自動分類與標示</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>• 系統自動歸類「不耐用治具」清單</li>
              <li>• 顯示紅色警示</li>
              <li>• 儀表板可統計比例</li>
            </ul>
          </div>

          <!-- 3. 原因分析與回報 -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-amber-100 text-amber-700 grid place-items-center font-bold">3</div>
              <h4 class="font-semibold">原因分析與回報</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>• 報廢時填寫損壞原因、使用環境</li>
              <li>• 可上傳照片</li>
              <li>• 供工程部分析設計問題</li>
            </ul>
          </div>

          <!-- 4. 系統提醒與學習回饋 -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-purple-100 text-purple-700 grid place-items-center font-bold">4</div>
              <h4 class="font-semibold">系統提醒與學習回饋</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>• 若同型號多次壽命不足</li>
              <li>• 自動提醒檢討</li>
              <li>• 持續優化治具設計</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- 不耐用治具清單 -->
      <div class="card p-5 space-y-4">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">不耐用治具清單(壽命未達預設值)</h3>
          <button class="btn btn-ghost text-sm" onclick="downloadCSV('undurable_fixtures.csv', toCSV(getUndurableFixtures()))">匯出清單</button>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">治具編號</th>
                <th class="py-2 pr-4">名稱</th>
                <th class="py-2 pr-4">預期壽命</th>
                <th class="py-2 pr-4">實際使用</th>
                <th class="py-2 pr-4">達成率</th>
                <th class="py-2 pr-4">警示等級</th>
                <th class="py-2 pr-4">負責人</th>
                <th class="py-2 pr-4">操作</th>
              </tr>
            </thead>
            <tbody id="undurableTable"></tbody>
          </table>
        </div>
      </div>

      <!-- 報廢原因登記表單 -->
      <div class="card p-5 space-y-4">
        <h3 class="font-semibold">報廢原因登記</h3>
        <div class="grid md:grid-cols-6 gap-3">
          <div class="field"><label class="label-xs">治具編號</label><select id="scrapFixture" class="input"></select></div>
          <div class="field"><label class="label-xs">報廢日期</label><input id="scrapDate" type="date" class="input" /></div>
          <div class="field"><label class="label-xs">損壞原因</label>
            <select id="scrapReason" class="input">
              <option>正常磨損</option>
              <option>材質問題</option>
              <option>設計缺陷</option>
              <option>操作不當</option>
              <option>意外損壞</option>
              <option>其他</option>
            </select>
          </div>
          <div class="field"><label class="label-xs">使用環境</label><input id="scrapEnv" class="input" placeholder="如:高溫/潮濕" /></div>
          <div class="field"><label class="label-xs">照片上傳</label><input id="scrapPhoto" type="file" accept="image/*" class="input text-xs" /></div>
          <div class="flex items-end"><button class="btn btn-primary w-full" onclick="toast('已記錄報廢原因(模擬)')">提交</button></div>
        </div>
        <div class="field">
          <label class="label-xs">詳細說明</label>
          <textarea id="scrapNote" class="input" rows="2" placeholder="請詳細描述損壞情況..."></textarea>
        </div>
      </div>
    </section>

    <!-- 使用/更換記錄 -->
    <section id="tab-logs" class="hidden space-y-4">
      <div class="card p-5 space-y-4">
        <div class="grid md:grid-cols-5 gap-3">
          <div class="field"><label class="label-xs">治具</label><select id="logFixture" class="input"></select></div>
          <div class="field"><label class="label-xs">區間(起)</label><input id="logFrom" type="date" class="input" /></div>
          <div class="field"><label class="label-xs">區間(迄)</label><input id="logTo" type="date" class="input" /></div>
          <div class="field"><label class="label-xs">類型</label><select id="logType" class="input"><option value="all">全部</option><option value="use">使用</option><option value="replace">更換</option></select></div>
          <div class="flex items-end gap-2"><button class="btn btn-primary w-full" onclick="toast('已套用篩選(模擬)')">套用</button></div>
        </div>

        <div class="flex flex-wrap items-center gap-2">
          <button class="btn btn-primary" onclick="toggleAddLog(true)">新增記錄</button>
          <label class="btn btn-ghost cursor-pointer"><input id="logCsv" type="file" accept=".csv" class="hidden" onchange="handleLogCsv(this)" /> 匯入 CSV</label>
          <button class="btn btn-ghost" onclick="downloadCSV('usage_replace_template.csv', sampleLogTemplate())">下載範本</button>
          <span class="text-xs text-gray-500">(欄位:date,fixture,loc,qty,type,note)</span>
        </div>

        <div id="addLogForm" class="hidden border rounded-2xl p-4 bg-gray-50">
          <div class="grid md:grid-cols-6 gap-3">
            <div class="field"><label class="label-xs">日期</label><input id="addLogDate" type="date" class="input" /></div>
            <div class="field"><label class="label-xs">治具</label><select id="addLogFixture" class="input"></select></div>
            <div class="field"><label class="label-xs">位置</label><input id="addLogLoc" class="input" placeholder="如:SMT1" /></div>
            <div class="field"><label class="label-xs">數量</label><input id="addLogQty" type="number" class="input" placeholder="1" /></div>
            <div class="field"><label class="label-xs">類型</label><select id="addLogType" class="input"><option value="use">使用</option><option value="replace">更換</option></select></div>
            <div class="field"><label class="label-xs">備註</label><input id="addLogNote" class="input" /></div>
          </div>
          <div class="flex justify-end gap-2 pt-3">
            <button class="btn btn-ghost" onclick="toggleAddLog(false)">取消</button>
            <button class="btn btn-primary" onclick="addLog()">新增</button>
          </div>
        </div>

        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr><th class="py-2 pr-4">日期</th><th class="py-2 pr-4">治具</th><th class="py-2 pr-4">位置</th><th class="py-2 pr-4">數量</th><th class="py-2 pr-4">類型</th><th class="py-2 pr-4">備註/異常</th></tr>
            </thead>
            <tbody id="logTable"></tbody>
          </table>
        </div>
        <div class="flex justify-end gap-2">
          <button class="btn btn-ghost" onclick="downloadCSV('usage_replace_logs.csv', toCSV(mockLogs))">匯出</button>
        </div>
      </div>
    </section>

    <!-- 後台管理(新增:子頁層) -->
    <section id="tab-admin" class="hidden space-y-4">
      <!-- 子頁層 -->
      <div class="flex flex-wrap gap-2">
        <button class="tab subtab-active" data-subtab="acct">帳號與權限</button>
        <button class="tab" data-subtab="smtp">SMTP 設定</button>
        <button class="tab" data-subtab="fixture">治具資料維護</button>
        <button class="tab" data-subtab="model">機種資料維護</button>
      </div>

      <!-- 帳號與權限 -->
      <div id="subtab-acct" class="card p-5 space-y-4">
        <h3 class="font-semibold">帳號與權限</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <!-- 新增帳戶 -->
          <div class="border rounded-2xl p-4 space-y-3">
            <div class="font-semibold text-sm">新增帳戶</div>
            <div class="grid gap-3">
              <div class="field"><label class="label-xs">帳號 (id)</label><input id="accAddId" class="input"/></div>
              <div class="field"><label class="label-xs">密碼</label><input id="accAddPwd" type="password" class="input"/></div>
              <div class="field"><label class="label-xs">Email</label><input id="accAddMail" type="email" class="input"/></div>
              <div class="field"><label class="label-xs">權限</label>
                <select id="accAddRole" class="input">
                  <option value="user">一般用戶(查詢/增加)</option>
                  <option value="admin">管理員(查詢/增修刪)</option>
                </select>
              </div>
              <button class="btn btn-primary" onclick="toast('已新增帳戶(模擬)')">新增</button>
            </div>
          </div>

          <!-- 刪除帳戶 -->
          <div class="border rounded-2xl p-4 space-y-3">
            <div class="font-semibold text-sm">刪除帳戶</div>
            <div class="grid gap-3">
              <div class="field"><label class="label-xs">帳號 (id)</label><input id="accDelId" class="input"/></div>
              <div class="field"><label class="label-xs">密碼</label><input id="accDelPwd" type="password" class="input"/></div>
              <button class="btn btn-ghost" onclick="toast('已刪除帳戶(模擬)')">刪除</button>
            </div>
          </div>

          <!-- 修改密碼 -->
          <div class="border rounded-2xl p-4 space-y-3">
            <div class="font-semibold text-sm">修改密碼</div>
            <div class="grid gap-3">
              <div class="field"><label class="label-xs">帳號 (id)</label><input id="accModId" class="input"/></div>
              <div class="field"><label class="label-xs">現行密碼</label><input id="accModPwd" type="password" class="input"/></div>
              <div class="field"><label class="label-xs">新密碼</label><input id="accModNew" type="password" class="input"/></div>
              <div class="field"><label class="label-xs">Email</label><input id="accModMail" type="email" class="input"/></div>
              <button class="btn btn-ghost" onclick="toast('已修改密碼(模擬)')">修改</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SMTP 設定(含更換通知對象) -->
      <div id="subtab-smtp" class="card p-5 space-y-4 hidden">
        <h3 class="font-semibold">SMTP 設定</h3>
        <div class="grid md:grid-cols-3 gap-3">
          <div class="field"><label class="label-xs">Email</label><input id="smtpEmail" class="input" placeholder="通知寄送 Email"/></div>
          <div class="field"><label class="label-xs">外送郵件伺服器名稱 (SMTP)</label><input id="smtpHost" class="input" placeholder="smtp.example.com"/></div>
          <div class="field"><label class="label-xs">埠號 (Port)</label><input id="smtpPort" class="input" placeholder="587"/></div>
          <div class="field"><label class="label-xs">認證狀態</label>
            <select id="smtpAuthState" class="input">
              <option>未認證</option><option>已認證</option>
            </select>
          </div>
          <div class="field"><label class="label-xs">認證帳號</label><input id="smtpUser" class="input" /></div>
          <div class="field"><label class="label-xs">認證密碼</label><input id="smtpPass" type="password" class="input" /></div>
          <div class="field"><label class="label-xs">寄件者名稱</label><input id="smtpSenderName" class="input" /></div>
          <div class="field"><label class="label-xs">寄件者信箱</label><input id="smtpSenderMail" type="email" class="input" /></div>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-primary" onclick="toast('已儲存 SMTP(模擬)')">儲存</button>
          <button class="btn btn-ghost" onclick="toast('測試寄信(模擬)')">測試寄信</button>
        </div>

        <div class="pt-2 border-t">
          <div class="flex items-center justify-between py-3">
            <h4 class="font-semibold">更換通知對象</h4>
            <button class="btn btn-ghost" onclick="downloadCSV('owners.csv', toCSV(mockOwners))">匯出負責人</button>
          </div>
          <div class="overflow-auto">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
                <tr><th class="py-2 pr-4">員編</th><th class="py-2 pr-4">姓名</th><th class="py-2 pr-4">Email</th><th class="py-2 pr-4">操作</th></tr>
              </thead>
              <tbody id="ownerTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- 治具資料維護 -->
      <div id="subtab-fixture" class="card p-5 space-y-3 hidden">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">治具資料維護</h3>
          <div class="flex items-center gap-2">
            <button class="btn btn-ghost" onclick="downloadCSV('fixtures_export.csv', toCSV(mockFixtures))">匯出</button>
            <button class="btn btn-ghost" onclick="downloadCSV('fixtures_template.csv', fixtureTemplate())">下載範本</button>
          </div>
        </div>
        <div class="grid md:grid-cols-5 gap-3">
          <div class="field"><label class="label-xs">治具名稱</label><input id="fxName" class="input" placeholder="名稱" /></div>
          <div class="field"><label class="label-xs">對應使用機種</label><input id="fxModel" class="input" placeholder="機種" /></div>
          <div class="field"><label class="label-xs">儲位</label><input id="fxLoc" class="input" placeholder="儲位" /></div>
          <div class="field"><label class="label-xs">狀態</label><input id="fxStatus" class="input" placeholder="active/inactive" /></div>
          <div class="field"><label class="label-xs">更換週期</label><input id="fxCycle" type="number" class="input" placeholder="次數" /></div>
        </div>
        <div class="flex items-center gap-2">
          <button class="btn btn-primary" onclick="addFixture()">新增</button>
          <label class="btn btn-ghost cursor-pointer"><input id="fxCsv" type="file" accept=".xlsx,.csv" class="hidden" onchange="handleFixtureCsv(this)" /> 匯入 Excel/CSV</label>
        </div>
        <div class="border-t pt-3">
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-600">共 <span id="fxCount">0</span> 筆</div>
            <div class="pagination flex items-center gap-2">
              <button class="btn btn-ghost text-xs" id="fxFirst" onclick="fxPage=1; renderFixtureList()">«</button>
              <button class="btn btn-ghost text-xs" id="fxPrev"  onclick="fxPage=Math.max(1,fxPage-1); renderFixtureList()">上一頁</button>
              <span class="text-xs">第 <span id="fxPageNow">1</span> / <span id="fxPageMax">1</span> 頁(每頁 8 筆)</span>
              <button class="btn btn-ghost text-xs" id="fxNext"  onclick="fxPage=Math.min(fxTotalPages,fxPage+1); renderFixtureList()">下一頁</button>
              <button class="btn btn-ghost text-xs" id="fxLast"  onclick="fxPage=fxTotalPages; renderFixtureList()">»</button>
            </div>
          </div>
          <div class="overflow-auto mt-2">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
                <tr><th class="py-2 pr-4">治具名稱</th><th class="py-2 pr-4">機種</th><th class="py-2 pr-4">儲位</th><th class="py-2 pr-4">狀態</th><th class="py-2 pr-4">更換週期</th><th class="py-2 pr-4">操作</th></tr>
              </thead>
              <tbody id="fxTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- 機種資料維護 -->
      <div id="subtab-model" class="card p-5 space-y-3 hidden">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">機種資料維護</h3>
          <div class="flex items-center gap-2">
            <button class="btn btn-ghost" onclick="downloadCSV('models_export.csv', toCSV(mockModels))">匯出</button>
            <button class="btn btn-ghost" onclick="downloadCSV('models_template.csv', modelTemplate())">下載範本</button>
          </div>
        </div>
        <div class="grid md:grid-cols-4 gap-3">
          <div class="field"><label class="label-xs">治具名稱</label><input id="mdFxName" class="input" placeholder="對應治具名稱" /></div>
          <div class="field"><label class="label-xs">對應使用機種</label><input id="mdModelName" class="input" placeholder="機種名稱" /></div>
          <div class="field"><label class="label-xs">站點</label><input id="mdPos" class="input" placeholder="站點/位置" /></div>
          <div class="field"><label class="label-xs">數量</label><input id="mdQty" type="number" class="input" placeholder="數量" /></div>
        </div>
        <div class="flex items-center gap-2">
          <button class="btn btn-primary" onclick="addModel()">新增</button>
          <label class="btn btn-ghost cursor-pointer"><input id="mdCsv" type="file" accept=".xlsx,.csv" class="hidden" onchange="handleModelCsv(this)" /> 匯入 Excel/CSV</label>
        </div>
        <div class="border-t pt-3">
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-600">共 <span id="mdCount">0</span> 筆</div>
            <div class="pagination flex items-center gap-2">
              <button class="btn btn-ghost text-xs" id="mdFirst" onclick="mdPage=1; renderModelList()">«</button>
              <button class="btn btn-ghost text-xs" id="mdPrev"  onclick="mdPage=Math.max(1,mdPage-1); renderModelList()">上一頁</button>
              <span class="text-xs">第 <span id="mdPageNow">1</span> / <span id="mdPageMax">1</span> 頁(每頁 8 筆)</span>
              <button class="btn btn-ghost text-xs" id="mdNext"  onclick="mdPage=Math.min(mdTotalPages,mdPage+1); renderModelList()">下一頁</button>
              <button class="btn btn-ghost text-xs" id="mdLast"  onclick="mdPage=mdTotalPages; renderModelList()">»</button>
            </div>
          </div>
          <div class="overflow-auto mt-2">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
                <tr><th class="py-2 pr-4">治具名稱</th><th class="py-2 pr-4">機種</th><th class="py-2 pr-4">站點</th><th class="py-2 pr-4">數量</th><th class="py-2 pr-4">操作</th></tr>
              </thead>
              <tbody id="mdTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden">
    <div class="bg-gray-900 text-white px-4 py-2 rounded-xl shadow-lg">訊息</div>
  </div>

    <!-- 引入 JavaScript -->
  <script src="/web/js/api-config.js"></script>
  <script src="/web/js/api-fixtures.js"></script>
  <script src="/web/js/api-receipts.js"></script>
  <script src="/web/js/api-logs.js"></script>
  <script src="/web/js/api-stats-auth.js"></script>
  <script src="/web/js/storage.js"></script>
  <script src="/web/js/utils.js"></script>
  <script src="/web/js/calculations.js"></script>
  <script src="/web/js/ui-render.js"></script>
  <script src="/web/js/auth.js"></script>
  <script src="/web/js/admin.js"></script>
  <script src="/web/js/app-main.js"></script>


</body>
</html>