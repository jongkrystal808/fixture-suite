<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/web/favicon.ico" type="image/x-icon">
  <title>æ²»å…·ç®¡ç†ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    button { border: 1px solid #D1D5DB; border-radius: 0.75rem; background:#fff; cursor:pointer; }
    .card { background:#fff; border:1px solid #E5E7EB; border-radius:1rem; box-shadow:0 1px 2px rgba(0,0,0,0.04); }
    .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .75rem; font-size:.875rem; font-weight:500; line-height:1.25rem; }
    .btn-primary { background:#111827; color:#fff; border-color:#111827; }
    .btn-ghost { background:#fff; color:#111827; border-color:#D1D5DB; }
    .pill { display:inline-block; font-size:.75rem; padding:.125rem .5rem; border-radius:9999px; border:1px solid #D1D5DB; }
    .tab { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .75rem; font-size:.875rem; font-weight:500; line-height:1.25rem; background:#fff; border:1px solid #D1D5DB; border-radius:.75rem; transition:all .15s ease; }
    .tab:hover { background:#F9FAFB; }
    .tab-active { background:#111827; color:#fff; border-color:#111827; font-weight:700; box-shadow:0 0 0 2px rgba(17,24,39,0.25) inset; }
    .section-title { font-size:1rem; font-weight:600; letter-spacing:.02em; }
    .subtab { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .75rem; font-size:.875rem; font-weight:500; line-height:1.25rem; background:#fff; border:1px solid #D1D5DB; border-radius:.75rem; transition:all .15s ease; }
    .subtab-active { background:#111827; color:#fff; border-color:#111827; font-weight:700; }
    .field { display:flex; flex-direction:column; gap:.25rem; }
    .label-xs { font-size:.75rem; color:#6B7280; }
    .input { border:1px solid #D1D5DB; border-radius:.75rem; padding:.5rem .75rem; }
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal { background:#fff; border-radius:1rem; width:100%; max-width:24rem; padding:1.25rem; border:1px solid #E5E7EB; }
    .pagination button[disabled] { opacity:.5; cursor:not-allowed; }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .warning-tag { background: #FEF3C7; color: #92400E; border: 1px solid #FCD34D; }
    .danger-tag { background: #FEE2E2; color: #991B1B; border: 1px solid #FCA5A5; }
  </style>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- ç™»å…¥ä»‹é¢ -->
  <div id="loginModal" class="modal-backdrop">
    <div class="modal space-y-4">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-lg">ç™»å…¥</h3>
        <button class="btn btn-ghost text-xs" onclick="closeLogin()">é—œé–‰</button>
      </div>
      <div class="grid gap-3">
        <div class="field"><label class="label-xs">å¸³è™Ÿ</label><input id="loginId" class="input" placeholder="è¼¸å…¥å¸³è™Ÿ"/></div>
        <div class="field"><label class="label-xs">å¯†ç¢¼</label><input id="loginPwd" type="password" class="input" placeholder="è¼¸å…¥å¯†ç¢¼"/></div>
        <button class="btn btn-primary" onclick="mockLogin()">ç™»å…¥</button>
        <p id="loginMsg" class="text-xs text-gray-500"></p>
      </div>
    </div>
  </div>

  <!-- é ‚éƒ¨å°è¦½ -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-8 rounded-xl bg-gray-900 text-white grid place-items-center font-bold">F</div>
        <div>
          <h1 class="text-lg font-semibold leading-tight">æ²»å…·ç®¡ç†ç³»çµ±</h1>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <span class="pill border-gray-300" id="clock">--:--</span>
        <span id="loginState" class="text-xs text-gray-600">æœªç™»å…¥</span>
        <button class="btn btn-ghost" id="btnLogin" onclick="openLogin()">ç™»å…¥</button>
      </div>
    </div>
  </header>

  <!-- ä¸»å®¹å™¨ -->
  <main class="mx-auto max-w-7xl p-4 md:p-6 space-y-6">
    <!-- åŠŸèƒ½åˆ†é  -->
    <nav class="grid grid-cols-2 md:grid-cols-7 gap-2">
      <button data-tab="dashboard" class="tab tab-active">å„€è¡¨æ¿</button>
      <button data-tab="receipts"  class="tab">æ”¶æ–™/é€€æ–™ç™»è¨˜</button>
      <button data-tab="query"    class="tab">æ²»å…·/æ©Ÿç¨®æŸ¥è©¢</button>
      <button data-tab="logs"     class="tab">ä½¿ç”¨/æ›´æ›è¨˜éŒ„</button>
      <button data-tab="stats"    class="tab">æ²»å…·æƒ…æ³çµ±è¨ˆ</button>
      <button data-tab="admin"    class="tab">å¾Œå°ç®¡ç†</button>
    </nav>

    <!-- ç•¶å‰åˆ‡é æ¨™é¡Œæ¬„ -->
    <div id="activeTabBanner" class="card px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-1.5 rounded-full bg-gray-900"></div>
        <div class="section-title" id="activeTabTitle">å„€è¡¨æ¿</div>
      </div>
    </div>

    <!-- å„€è¡¨æ¿ -->
    <section id="tab-dashboard" class="space-y-6">
      <div class="grid md:grid-cols-3 gap-4">
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">ä»Šæ—¥æ”¶æ–™</h3>
            <span class="pill border-green-300 text-green-700 bg-green-50">å³æ™‚</span>
          </div>
          <p class="text-3xl font-bold mt-2" id="todayIn">0</p>
          <div class="mt-3 space-y-2" id="todayInList"></div>
        </div>
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">ä»Šæ—¥é€€æ–™</h3>
            <span class="pill border-blue-300 text-blue-700 bg-blue-50">å³æ™‚</span>
          </div>
          <p class="text-3xl font-bold mt-2" id="todayOut">0</p>
          <div class="mt-3 space-y-2" id="todayOutList"></div>
        </div>
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">å³å°‡æ›´æ›æ²»å…·</h3>
            <button class="btn btn-ghost text-xs" onclick="downloadCSV('upcoming.csv', mockUpcomingCSV())">åŒ¯å‡º</button>
          </div>
          <div class="mt-3 space-y-2 max-h-40 overflow-auto" id="upcomingList"></div>
        </div>
      </div>

      <div class="card p-5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold">åº«å­˜æ¦‚è¦½</h3>
          <div class="flex items-center gap-2">
            <input id="searchDash" class="w-48 border rounded-xl px-3 py-1.5 text-sm" placeholder="æœå°‹æ²»å…·/æ©Ÿç¨®..." />
            <button class="btn btn-ghost text-sm" onclick="filterDashboard()">ç¯©é¸</button>
          </div>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">æ²»å…·ç·¨è™Ÿ</th>
                <th class="py-2 pr-4">åç¨±</th>
                <th class="py-2 pr-4">æ©Ÿç¨®</th>
                <th class="py-2 pr-4">å„²ä½</th>
                <th class="py-2 pr-4">ç‹€æ…‹</th>
                <th class="py-2 pr-4">ä½¿ç”¨æ¬¡æ•¸/é€±æœŸ</th>
                <th class="py-2 pr-4">è² è²¬äºº</th>
              </tr>
            </thead>
            <tbody id="dashTable"></tbody>
          </table>
        </div>
      </div>
    </section>

       <!-- æ”¶æ–™ / é€€æ–™ -->
    <section id="tab-receipts" class="hidden space-y-4">

      <!-- å­åˆ†é  -->
      <div class="flex gap-2">
        <button class="subtab subtab-active" data-rtab="receipts">æ”¶æ–™ç™»è¨˜</button>
        <button class="subtab" data-rtab="returns">é€€æ–™ç™»è¨˜</button>
      </div>

      <!-- ============================================================= -->
      <!-- ğŸ”µ æ”¶æ–™ TAB -->
      <!-- ============================================================= -->
      <div id="rtab-receipts" class="space-y-4">

        <div class="card p-5 space-y-4">
          <h3 class="font-semibold text-lg">æ”¶æ–™ç™»è¨˜</h3>

          <!-- æŸ¥è©¢ -->
          <div class="grid md:grid-cols-6 gap-3">
            <div class="field">
              <label class="label-xs">æ²»å…·ç·¨è™Ÿ</label>
              <input id="receiptSearchFixture" class="input" placeholder="æ²»å…·ç·¨è™Ÿ">
            </div>

            <div class="field">
              <label class="label-xs">å–®è™Ÿ</label>
              <input id="receiptSearchOrder" class="input" placeholder="å–®è™Ÿ">
            </div>

            <div class="field">
              <label class="label-xs">å» å•†</label>
              <input id="receiptSearchVendor" class="input" placeholder="å» å•†">
            </div>

            <div class="field">
              <label class="label-xs">æ“ä½œäººå“¡</label>
              <input id="receiptSearchOperator" class="input" placeholder="å“¡å·¥è™Ÿ">
            </div>

            <div class="flex items-end">
              <button class="btn btn-primary w-full" onclick="loadReceipts()">æŸ¥è©¢</button>
            </div>
          </div>

          <!-- æ–°å¢ / åŒ¯å…¥æŒ‰éˆ• -->
          <div class="flex gap-2 flex-wrap">
            <button class="btn btn-primary" onclick="toggleReceiptAdd(true)">æ–°å¢æ”¶æ–™è¨˜éŒ„</button>

            <label class="btn btn-ghost cursor-pointer">
              <input id="receiptXlsx" type="file" accept=".xlsx" class="hidden"
                     onchange="handleReceiptImport(this)" />
              åŒ¯å…¥ Excel(.xlsx)
            </label>

            <button class="btn btn-ghost" onclick="downloadReceiptTemplate()">ä¸‹è¼‰ç¯„æœ¬</button>
          </div>

          <!-- æ–°å¢è¡¨å–® -->
          <div id="receiptAddForm" class="hidden border rounded-2xl p-4 bg-gray-50 space-y-3">

            <div class="grid md:grid-cols-5 gap-3">
              <div class="field">
                <label class="label-xs">å» å•†</label>
                <input id="receiptAddVendor" class="input">
              </div>

              <div class="field">
                <label class="label-xs">å–®è™Ÿ</label>
                <input id="receiptAddOrder" class="input">
              </div>

              <div class="field">
                <label class="label-xs">æ²»å…·ç·¨è™Ÿ</label>
                <input id="receiptAddFixture" class="input">
              </div>

              <div class="field">
                <label class="label-xs">é¡å‹</label>
                <select id="receiptAddType" class="input">
                  <option value="batch">æ‰¹é‡ï¼ˆserial_start ~ serial_endï¼‰</option>
                  <option value="individual">å°‘é‡åºè™Ÿï¼ˆserialsï¼‰</option>
                </select>
              </div>
            </div>

            <!-- æ‰¹é‡ï¼šæµæ°´è™Ÿèµ·è¨– -->
            <div id="receiptBatchArea" class="grid md:grid-cols-5 gap-3">
              <div class="field">
                <label class="label-xs">åºè™Ÿèµ·å§‹</label>
                <input id="receiptAddStart" class="input">
              </div>
              <div class="field">
                <label class="label-xs">åºè™ŸçµæŸ</label>
                <input id="receiptAddEnd" class="input">
              </div>
            </div>

            <!-- å°‘é‡åºè™Ÿ -->
            <div id="receiptIndividualArea" class="hidden">
              <label class="label-xs">åºè™Ÿï¼ˆé€—è™Ÿåˆ†éš”ï¼‰</label>
              <input id="receiptAddSerials" class="input">
            </div>

            <div class="field">
              <label class="label-xs">å‚™è¨»</label>
              <input id="receiptAddNote" class="input">
            </div>

            <div class="flex justify-end gap-2">
              <button class="btn btn-ghost" onclick="toggleReceiptAdd(false)">å–æ¶ˆ</button>
              <button class="btn btn-primary" onclick="submitReceipt()">æäº¤</button>
            </div>
          </div>

          <!-- æ”¶æ–™è¡¨æ ¼ -->
          <div class="overflow-auto">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">æ—¥æœŸ</th>
                <th class="py-2 pr-4">æ²»å…·</th>
                <th class="py-2 pr-4">å» å•†</th>
                <th class="py-2 pr-4">å–®è™Ÿ</th>
                <th class="py-2 pr-4">åºè™Ÿ</th>
                <th class="py-2 pr-4">æ“ä½œäººå“¡</th>
                <th class="py-2 pr-4">å‚™è¨»</th>
                <th class="py-2 pr-4">åˆªé™¤</th>
              </tr>
              </thead>
              <tbody id="receiptTable"></tbody>
            </table>
          </div>
        </div>

      </div>

      <!-- ============================================================= -->
      <!-- ğŸŸ  é€€æ–™ TAB -->
      <!-- ============================================================= -->
      <div id="rtab-returns" class="hidden space-y-4">

        <div class="card p-5 space-y-4">
          <h3 class="font-semibold text-lg">é€€æ–™ç™»è¨˜</h3>

          <!-- æŸ¥è©¢ -->
          <div class="grid md:grid-cols-6 gap-3">
            <div class="field">
              <label class="label-xs">æ²»å…·ç·¨è™Ÿ</label>
              <input id="returnSearchFixture" class="input" placeholder="æ²»å…·ç·¨è™Ÿ">
            </div>

            <div class="field">
              <label class="label-xs">å–®è™Ÿ</label>
              <input id="returnSearchOrder" class="input" placeholder="å–®è™Ÿ">
            </div>

            <div class="field">
              <label class="label-xs">å» å•†</label>
              <input id="returnSearchVendor" class="input" placeholder="å» å•†">
            </div>

            <div class="field">
              <label class="label-xs">æ“ä½œäººå“¡</label>
              <input id="returnSearchOperator" class="input" placeholder="å“¡å·¥è™Ÿ">
            </div>

            <div class="flex items-end">
              <button class="btn btn-primary w-full" onclick="loadReturns()">æŸ¥è©¢</button>
            </div>
          </div>

          <!-- æ–°å¢ / åŒ¯å…¥ -->
          <div class="flex gap-2 flex-wrap">
            <button class="btn btn-primary" onclick="toggleReturnAdd(true)">æ–°å¢é€€æ–™è¨˜éŒ„</button>

            <label class="btn btn-ghost cursor-pointer">
              <input id="returnXlsx" type="file" accept=".xlsx" class="hidden"
                     onchange="handleReturnImport(this)" />
              åŒ¯å…¥ Excel(.xlsx)
            </label>

            <button class="btn btn-ghost" onclick="downloadReturnTemplate()">ä¸‹è¼‰ç¯„æœ¬</button>
          </div>

          <!-- æ–°å¢è¡¨å–® -->
          <div id="returnAddForm" class="hidden border rounded-2xl p-4 bg-gray-50 space-y-3">

            <div class="grid md:grid-cols-5 gap-3">
              <div class="field">
                <label class="label-xs">å» å•†</label>
                <input id="returnAddVendor" class="input">
              </div>

              <div class="field">
                <label class="label-xs">å–®è™Ÿ</label>
                <input id="returnAddOrder" class="input">
              </div>

              <div class="field">
                <label class="label-xs">æ²»å…·ç·¨è™Ÿ</label>
                <input id="returnAddFixture" class="input">
              </div>

              <div class="field">
                <label class="label-xs">é¡å‹</label>
                <select id="returnAddType" class="input">
                  <option value="batch">æ‰¹é‡ï¼ˆserial_start ~ serial_endï¼‰</option>
                  <option value="individual">å°‘é‡åºè™Ÿï¼ˆserialsï¼‰</option>
                </select>
              </div>
            </div>

            <!-- æ‰¹é‡ï¼šæµæ°´è™Ÿèµ·è¨– -->
            <div id="returnBatchArea" class="grid md:grid-cols-5 gap-3">
              <div class="field">
                <label class="label-xs">åºè™Ÿèµ·å§‹</label>
                <input id="returnAddStart" class="input">
              </div>
              <div class="field">
                <label class="label-xs">åºè™ŸçµæŸ</label>
                <input id="returnAddEnd" class="input">
              </div>
            </div>

            <!-- å°‘é‡åºè™Ÿ -->
            <div id="returnIndividualArea" class="hidden">
              <label class="label-xs">åºè™Ÿï¼ˆé€—è™Ÿåˆ†éš”ï¼‰</label>
              <input id="returnAddSerials" class="input">
            </div>

            <div class="field">
              <label class="label-xs">å‚™è¨»</label>
              <input id="returnAddNote" class="input">
            </div>

            <div class="flex justify-end gap-2">
              <button class="btn btn-ghost" onclick="toggleReturnAdd(false)">å–æ¶ˆ</button>
              <button class="btn btn-primary" onclick="submitReturn()">æäº¤</button>
            </div>
          </div>

          <!-- é€€æ–™è¡¨æ ¼ -->
          <div class="overflow-auto">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">æ—¥æœŸ</th>
                <th class="py-2 pr-4">æ²»å…·</th>
                <th class="py-2 pr-4">å» å•†</th>
                <th class="py-2 pr-4">å–®è™Ÿ</th>
                <th class="py-2 pr-4">åºè™Ÿ</th>
                <th class="py-2 pr-4">æ“ä½œäººå“¡</th>
                <th class="py-2 pr-4">å‚™è¨»</th>
                <th class="py-2 pr-4">åˆªé™¤</th>
              </tr>
              </thead>
              <tbody id="returnTable"></tbody>
            </table>
          </div>
        </div>

      </div>

    </section>

        <!-- æŸ¥è©¢æ¨¡å¡Š -->
    <section id="tab-query" class="hidden space-y-4">
      <div class="card p-5 space-y-4">
        <h3 class="font-semibold text-lg">æ²»å…·ï¼æ©Ÿç¨®æŸ¥è©¢</h3>

        <!-- åˆ‡æ›æŸ¥è©¢é¡å‹ -->
        <div class="flex gap-4 items-center">
          <label class="font-semibold">æŸ¥è©¢é¡å‹ï¼š</label>
          <select id="queryType" class="input w-60" onchange="switchQueryType()">
            <option value="fixture">æ²»å…·æŸ¥è©¢</option>
            <option value="model">æ©Ÿç¨®æŸ¥è©¢</option>
          </select>
        </div>

        <!-- ============================= -->
        <!-- ğŸ”¹ æ²»å…·æŸ¥è©¢å€ -->
        <!-- ============================= -->
        <div id="fixtureQueryArea" class="space-y-3">
          <div class="flex gap-3">
            <input id="fixtureSearch" class="input w-64" placeholder="è¼¸å…¥æ²»å…·ç·¨è™Ÿæˆ–åç¨±" oninput="loadFixturesQuery()" />
            <select id="fixtureStatus" class="input w-40" onchange="loadFixturesQuery()">
              <option value="">å…¨éƒ¨ç‹€æ…‹</option>
              <option value="æ­£å¸¸">æ­£å¸¸</option>
              <option value="è¿”é‚„">è¿”é‚„</option>
              <option value="å ±å»¢">å ±å»¢</option>
            </select>
            <button class="btn btn-primary" onclick="loadFixturesQuery()">æŸ¥è©¢</button>
          </div>

          <div class="overflow-x-auto border rounded-lg shadow-sm">
            <table class="min-w-full text-sm text-center border-collapse">
              <thead class="text-gray-700 bg-gray-50 border-b">
                <tr>
                  <th class="py-2 px-4 w-24">æ²»å…·ç·¨è™Ÿ</th>
                  <th class="py-2 px-4 w-32">åç¨±</th>
                  <th class="py-2 px-4 w-32">é¡å‹</th>
                  <th class="py-2 px-4 w-44">åº«å­˜(è‡ªè³¼/å®¢ä¾›/ç¸½)</th>
                  <th class="py-2 px-4 w-24">ç‹€æ…‹</th>
                  <th class="py-2 px-4 w-24">å„²ä½</th>
                  <th class="py-2 px-4 w-32">è² è²¬äºº</th>
                  <th class="py-2 px-4 w-48">å‚™è¨»</th>
                </tr>
              </thead>
              <tbody id="fixtureTable" class="divide-y divide-gray-100 text-gray-800"></tbody>
            </table>
          </div>
        </div>

        <!-- ============================= -->
        <!-- ğŸ”¹ æ©Ÿç¨®æŸ¥è©¢å€ -->
        <!-- ============================= -->
        <div id="modelQueryArea" class="hidden space-y-3">
          <div class="flex gap-3">
            <input id="modelSearch" class="input w-64" placeholder="è¼¸å…¥æ©Ÿç¨®ä»£ç¢¼æˆ–åç¨±" oninput="loadModelsQuery()" />
            <button class="btn btn-primary" onclick="loadModelsQuery()">æŸ¥è©¢</button>
          </div>

          <div class="overflow-x-auto border rounded-lg shadow-sm">
            <table class="min-w-full text-sm text-center border-collapse">
              <thead class="text-gray-700 bg-gray-50 border-b">
                <tr>
                  <th class="py-2 px-4 w-32">æ©Ÿç¨®ä»£ç¢¼</th>
                  <th class="py-2 px-4 w-40">åç¨±</th>
                  <th class="py-2 px-4 w-64">å‚™è¨»</th>
                  <th class="py-2 px-4 w-24">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="modelTable" class="divide-y divide-gray-100 text-gray-800"></tbody>
            </table>
          </div>

          <!-- ============================= -->
          <!-- ğŸ”¹ é¡¯ç¤ºæœ€å¤§é–‹ç«™æ•¸ -->
          <!-- ============================= -->
          <div id="maxStationArea" class="hidden mt-5">
            <h4 class="font-semibold mb-2">æœ€å¤§é–‹ç«™æ•¸</h4>
            <div class="overflow-x-auto border rounded-lg shadow-sm">
              <table class="min-w-full text-sm text-center border-collapse">
                <thead class="text-gray-700 bg-gray-50 border-b">
                  <tr>
                    <th class="py-2 px-4 w-32">ç«™é»ä»£ç¢¼</th>
                    <th class="py-2 px-4 w-40">ç«™é»åç¨±</th>
                    <th class="py-2 px-4 w-32">æœ€å¤§é–‹ç«™æ•¸</th>
                    <th class="py-2 px-4 w-40">ç“¶é ¸æ²»å…·</th>
                    <th class="py-2 px-4 w-40">å¯ç”¨/éœ€æ±‚æ•¸</th>
                  </tr>
                </thead>
                <tbody id="maxStationTable" class="divide-y divide-gray-100 text-gray-800"></tbody>
              </table>
            </div>
          </div>

          <!-- ============================= -->
          <!-- ğŸ”¹ é¡¯ç¤ºæ²»å…·éœ€æ±‚æ˜ç´° -->
          <!-- ============================= -->
          <div id="stationDetailArea" class="hidden mt-5">
            <h4 class="font-semibold mb-2">
              æ²»å…·éœ€æ±‚æ˜ç´°ï¼š<span id="stationDetailTitle" class="text-indigo-600"></span>
            </h4>
            <div class="overflow-x-auto border rounded-lg shadow-sm">
              <table class="min-w-full text-sm text-center border-collapse">
                <thead class="text-gray-700 bg-gray-50 border-b">
                  <tr>
                    <th class="py-2 px-4 w-32">æ²»å…·ç·¨è™Ÿ</th>
                    <th class="py-2 px-4 w-48">æ²»å…·åç¨±</th>
                    <th class="py-2 px-4 w-24">éœ€æ±‚æ•¸é‡</th>
                    <th class="py-2 px-4 w-24">å¯ç”¨æ•¸é‡</th>
                    <th class="py-2 px-4 w-32">å¯æ”¯æ´ç«™æ•¸</th>
                  </tr>
                </thead>
                <tbody id="stationDetailTable" class="divide-y divide-gray-100 text-gray-800"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>



    <!-- æ²»å…·æƒ…æ³çµ±è¨ˆ(æ–°å¢åˆ†é ) -->
    <section id="tab-stats" class="hidden space-y-4">
      <!-- çµ±è¨ˆå¡ç‰‡ -->
      <div class="grid md:grid-cols-4 gap-4">
        <div class="card p-5 stat-card">
          <div class="text-sm opacity-90">ç¸½æ²»å…·æ•¸é‡</div>
          <div class="text-3xl font-bold mt-2" id="statTotalFixtures">0</div>
        </div>
        <div class="card p-5 bg-gradient-to-br from-green-400 to-emerald-600 text-white">
          <div class="text-sm opacity-90">æ­£å¸¸ä½¿ç”¨ä¸­</div>
          <div class="text-3xl font-bold mt-2" id="statActiveFixtures">0</div>
        </div>
        <div class="card p-5 bg-gradient-to-br from-amber-400 to-orange-600 text-white">
          <div class="text-sm opacity-90">å£½å‘½æœªé”æ¨™</div>
          <div class="text-3xl font-bold mt-2" id="statUnderLifespan">0</div>
        </div>
        <div class="card p-5 bg-gradient-to-br from-red-400 to-rose-600 text-white">
          <div class="text-sm opacity-90">å³å°‡æ›´æ›</div>
          <div class="text-3xl font-bold mt-2" id="statNeedReplacement">0</div>
        </div>
      </div>

      <!-- æ²»å…·å£½å‘½ç®¡ç†ä½œæ³• -->
      <div class="card p-5 space-y-4">
        <h3 class="font-semibold text-lg">æ²»å…·å£½å‘½ç®¡ç†ä½œæ³•(é‡å°ä¸è€ç”¨æ²»å…·)</h3>

        <div class="grid md:grid-cols-2 gap-4">
          <!-- 1. å»ºç«‹å£½å‘½æ¯”å°æ©Ÿåˆ¶ -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-blue-100 text-blue-700 grid place-items-center font-bold">1</div>
              <h4 class="font-semibold">å»ºç«‹å£½å‘½æ¯”å°æ©Ÿåˆ¶</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>â€¢ æ¯å€‹æ²»å…·è¨­å®šé æœŸå£½å‘½(æ¬¡æ•¸æˆ–å¤©æ•¸)</li>
              <li>â€¢ ç³»çµ±è¨˜éŒ„å¯¦éš›ä½¿ç”¨æ¬¡æ•¸</li>
              <li>â€¢ æœªé”æ¨™è‡ªå‹•æ¨™ç¤ºã€Œå£½å‘½æœªé”é è¨­å€¼ã€</li>
            </ul>
          </div>

          <!-- 2. è‡ªå‹•åˆ†é¡èˆ‡æ¨™ç¤º -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-green-100 text-green-700 grid place-items-center font-bold">2</div>
              <h4 class="font-semibold">è‡ªå‹•åˆ†é¡èˆ‡æ¨™ç¤º</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>â€¢ ç³»çµ±è‡ªå‹•æ­¸é¡ã€Œä¸è€ç”¨æ²»å…·ã€æ¸…å–®</li>
              <li>â€¢ é¡¯ç¤ºç´…è‰²è­¦ç¤º</li>
              <li>â€¢ å„€è¡¨æ¿å¯çµ±è¨ˆæ¯”ä¾‹</li>
            </ul>
          </div>

          <!-- 3. åŸå› åˆ†æèˆ‡å›å ± -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-amber-100 text-amber-700 grid place-items-center font-bold">3</div>
              <h4 class="font-semibold">åŸå› åˆ†æèˆ‡å›å ±</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>â€¢ å ±å»¢æ™‚å¡«å¯«æå£åŸå› ã€ä½¿ç”¨ç’°å¢ƒ</li>
              <li>â€¢ å¯ä¸Šå‚³ç…§ç‰‡</li>
              <li>â€¢ ä¾›å·¥ç¨‹éƒ¨åˆ†æè¨­è¨ˆå•é¡Œ</li>
            </ul>
          </div>

          <!-- 4. ç³»çµ±æé†’èˆ‡å­¸ç¿’å›é¥‹ -->
          <div class="border rounded-xl p-4 space-y-3">
            <div class="flex items-center gap-2">
              <div class="h-8 w-8 rounded-lg bg-purple-100 text-purple-700 grid place-items-center font-bold">4</div>
              <h4 class="font-semibold">ç³»çµ±æé†’èˆ‡å­¸ç¿’å›é¥‹</h4>
            </div>
            <ul class="text-sm text-gray-600 space-y-2 ml-10">
              <li>â€¢ è‹¥åŒå‹è™Ÿå¤šæ¬¡å£½å‘½ä¸è¶³</li>
              <li>â€¢ è‡ªå‹•æé†’æª¢è¨</li>
              <li>â€¢ æŒçºŒå„ªåŒ–æ²»å…·è¨­è¨ˆ</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- ä¸è€ç”¨æ²»å…·æ¸…å–® -->
      <div class="card p-5 space-y-4">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">ä¸è€ç”¨æ²»å…·æ¸…å–®(å£½å‘½æœªé”é è¨­å€¼)</h3>
          <button class="btn btn-ghost text-sm" onclick="downloadCSV('undurable_fixtures.csv', toCSV(getUndurableFixtures()))">åŒ¯å‡ºæ¸…å–®</button>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">æ²»å…·ç·¨è™Ÿ</th>
                <th class="py-2 pr-4">åç¨±</th>
                <th class="py-2 pr-4">é æœŸå£½å‘½</th>
                <th class="py-2 pr-4">å¯¦éš›ä½¿ç”¨</th>
                <th class="py-2 pr-4">é”æˆç‡</th>
                <th class="py-2 pr-4">è­¦ç¤ºç­‰ç´š</th>
                <th class="py-2 pr-4">è² è²¬äºº</th>
                <th class="py-2 pr-4">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="undurableTable"></tbody>
          </table>
        </div>
      </div>

      <!-- å ±å»¢åŸå› ç™»è¨˜è¡¨å–® -->
      <div class="card p-5 space-y-4">
        <h3 class="font-semibold">å ±å»¢åŸå› ç™»è¨˜</h3>
        <div class="grid md:grid-cols-6 gap-3">
          <div class="field"><label class="label-xs">æ²»å…·ç·¨è™Ÿ</label><select id="scrapFixture" class="input"></select></div>
          <div class="field"><label class="label-xs">å ±å»¢æ—¥æœŸ</label><input id="scrapDate" type="date" class="input" /></div>
          <div class="field"><label class="label-xs">æå£åŸå› </label>
            <select id="scrapReason" class="input">
              <option>æ­£å¸¸ç£¨æ</option>
              <option>æè³ªå•é¡Œ</option>
              <option>è¨­è¨ˆç¼ºé™·</option>
              <option>æ“ä½œä¸ç•¶</option>
              <option>æ„å¤–æå£</option>
              <option>å…¶ä»–</option>
            </select>
          </div>
          <div class="field"><label class="label-xs">ä½¿ç”¨ç’°å¢ƒ</label><input id="scrapEnv" class="input" placeholder="å¦‚:é«˜æº«/æ½®æ¿•" /></div>
          <div class="field"><label class="label-xs">ç…§ç‰‡ä¸Šå‚³</label><input id="scrapPhoto" type="file" accept="image/*" class="input text-xs" /></div>
          <div class="flex items-end"><button class="btn btn-primary w-full" onclick="toast('å·²è¨˜éŒ„å ±å»¢åŸå› (æ¨¡æ“¬)')">æäº¤</button></div>
        </div>
        <div class="field">
          <label class="label-xs">è©³ç´°èªªæ˜</label>
          <textarea id="scrapNote" class="input" rows="2" placeholder="è«‹è©³ç´°æè¿°æå£æƒ…æ³..."></textarea>
        </div>
      </div>
    </section>

       <!-- ä½¿ç”¨ / æ›´æ›è¨˜éŒ„ -->
    <section id="tab-logs" class="hidden space-y-4">

      <!-- å­åˆ†é  -->
      <div class="flex gap-2">
        <button class="subtab subtab-active" data-logtab="usage">ä½¿ç”¨è¨˜éŒ„</button>
        <button class="subtab" data-logtab="replacement">æ›´æ›è¨˜éŒ„</button>
      </div>

      <!-- ================================ -->
      <!-- ğŸ”µ ä½¿ç”¨è¨˜éŒ„ TAB -->
      <!-- ================================ -->
      <div id="logtab-usage" class="space-y-4">

        <div class="card p-5 space-y-4">
          <h3 class="font-semibold text-lg">ä½¿ç”¨è¨˜éŒ„</h3>

          <!-- æŸ¥è©¢å€ -->
          <div class="grid md:grid-cols-6 gap-3">
            <div class="field">
              <label class="label-xs">æ²»å…·</label>
              <input id="usageSearchFixture" class="input" placeholder="æ²»å…·ç·¨è™Ÿ" />
            </div>
            <div class="field">
              <label class="label-xs">ç«™é» ID</label>
              <input id="usageSearchStation" class="input" type="number" placeholder="ç«™é» ID" />
            </div>
            <div class="field">
              <label class="label-xs">æ“ä½œäººå“¡</label>
              <input id="usageSearchOperator" class="input" placeholder="å“¡å·¥è™Ÿ" />
            </div>
            <div class="field">
              <label class="label-xs">æ—¥æœŸèµ·</label>
              <input id="usageSearchFrom" type="datetime-local" class="input" />
            </div>
            <div class="field">
              <label class="label-xs">æ—¥æœŸè¿„</label>
              <input id="usageSearchTo" type="datetime-local" class="input" />
            </div>
            <div class="flex items-end">
              <button class="btn btn-primary w-full" onclick="loadUsageLogs()">æŸ¥è©¢</button>
            </div>
          </div>

          <!-- æ–°å¢ / æ‰¹é‡ / åŒ¯å…¥æŒ‰éˆ• -->
          <div class="flex gap-2 flex-wrap">
            <button class="btn btn-primary" onclick="toggleUsageAdd(true)">æ–°å¢ä½¿ç”¨è¨˜éŒ„</button>

            <label class="btn btn-ghost cursor-pointer">
              <input id="usageXlsx" type="file" accept=".xlsx" class="hidden"
                     onchange="handleUsageImport(this)" />
              åŒ¯å…¥ Excel(.xlsx)
            </label>

            <button class="btn btn-ghost" onclick="downloadUsageTemplate()">ä¸‹è¼‰ç¯„æœ¬</button>
          </div>

          <!-- æ–°å¢è¡¨å–® -->
          <div id="usageAddForm" class="hidden border rounded-2xl p-4 bg-gray-50 space-y-3">

            <div class="grid md:grid-cols-6 gap-3">
              <div class="field">
                <label class="label-xs">æ²»å…·ç·¨è™Ÿ</label>
                <input id="usageAddFixture" class="input" />
              </div>

              <div class="field">
                <label class="label-xs">ç«™é» ID</label>
                <input id="usageAddStation" class="input" type="number" />
              </div>

              <div class="field">
                <label class="label-xs">ä½¿ç”¨æ¬¡æ•¸</label>
                <input id="usageAddCount" type="number" class="input" value="1" />
              </div>

              <div class="field">
                <label class="label-xs">ç•°å¸¸ç‹€æ…‹</label>
                <input id="usageAddAbnormal" class="input" />
              </div>

              <div class="field">
                <label class="label-xs">æ“ä½œäººå“¡</label>
                <input id="usageAddOperator" class="input" />
              </div>

              <div class="field">
                <label class="label-xs">ä½¿ç”¨æ™‚é–“</label>
                <input id="usageAddTime" type="datetime-local" class="input" />
              </div>
            </div>

            <div class="field">
              <label class="label-xs">å‚™è¨»</label>
              <input id="usageAddNote" class="input" />
            </div>

            <div class="grid md:grid-cols-6 gap-3">
              <div class="field">
                <label class="label-xs">æ‰¹é‡ç­†æ•¸ï¼ˆå¦‚ä¸æ‰¹é‡ç•™ç©ºï¼‰</label>
                <input id="usageAddBatch" type="number" class="input" />
              </div>
            </div>

            <div class="flex justify-end gap-2">
              <button class="btn btn-ghost" onclick="toggleUsageAdd(false)">å–æ¶ˆ</button>
              <button class="btn btn-primary" onclick="submitUsageLog()">æäº¤</button>
            </div>
          </div>

          <!-- ä½¿ç”¨è¨˜éŒ„è¡¨æ ¼ -->
          <div class="overflow-auto">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">æ—¥æœŸ</th>
                <th class="py-2 pr-4">æ²»å…·</th>
                <th class="py-2 pr-4">ç«™é»</th>
                <th class="py-2 pr-4">æ¬¡æ•¸</th>
                <th class="py-2 pr-4">ç•°å¸¸</th>
                <th class="py-2 pr-4">æ“ä½œäººå“¡</th>
                <th class="py-2 pr-4">å‚™è¨»</th>
                <th class="py-2 pr-4">åˆªé™¤</th>
              </tr>
              </thead>
              <tbody id="usageTable"></tbody>
            </table>
          </div>

        </div>
      </div>

      <!-- ================================ -->
      <!-- ğŸŸ  æ›´æ›è¨˜éŒ„ TAB -->
      <!-- ================================ -->
      <div id="logtab-replacement" class="hidden space-y-4">

        <div class="card p-5 space-y-4">
          <h3 class="font-semibold text-lg">æ›´æ›è¨˜éŒ„</h3>

          <!-- æŸ¥è©¢ -->
          <div class="grid md:grid-cols-6 gap-3">
            <div class="field">
              <label class="label-xs">æ²»å…·</label>
              <input id="replaceSearchFixture" class="input" />
            </div>
            <div class="field">
              <label class="label-xs">åŸ·è¡Œäººå“¡</label>
              <input id="replaceSearchExec" class="input" />
            </div>
            <div class="field">
              <label class="label-xs">æ›´æ›æ—¥æœŸèµ·</label>
              <input id="replaceSearchFrom" type="date" class="input" />
            </div>
            <div class="field">
              <label class="label-xs">æ›´æ›æ—¥æœŸè¿„</label>
              <input id="replaceSearchTo" type="date" class="input" />
            </div>
            <div class="flex items-end">
              <button class="btn btn-primary w-full" onclick="loadReplacementLogs()">æŸ¥è©¢</button>
            </div>
          </div>

          <!-- æ–°å¢ / æ‰¹é‡ / åŒ¯å…¥ -->
          <div class="flex gap-2 flex-wrap">
            <button class="btn btn-primary" onclick="toggleReplaceAdd(true)">æ–°å¢æ›´æ›è¨˜éŒ„</button>

            <label class="btn btn-ghost cursor-pointer">
              <input id="replaceXlsx" type="file" accept=".xlsx" class="hidden"
                     onchange="handleReplaceImport(this)" />
              åŒ¯å…¥ Excel(.xlsx)
            </label>

            <button class="btn btn-ghost" onclick="downloadReplaceTemplate()">ä¸‹è¼‰ç¯„æœ¬</button>
          </div>

          <!-- æ–°å¢è¡¨å–® -->
          <div id="replaceAddForm" class="hidden border rounded-2xl p-4 bg-gray-50 space-y-3">

            <div class="grid md:grid-cols-5 gap-3">
              <div class="field">
                <label class="label-xs">æ²»å…·ç·¨è™Ÿ</label>
                <input id="replaceAddFixture" class="input" />
              </div>
              <div class="field">
                <label class="label-xs">æ›´æ›æ—¥æœŸ</label>
                <input id="replaceAddDate" type="date" class="input" />
              </div>
              <div class="field">
                <label class="label-xs">åŸå› </label>
                <input id="replaceAddReason" class="input" />
              </div>
              <div class="field">
                <label class="label-xs">åŸ·è¡Œäººå“¡</label>
                <input id="replaceAddExecutor" class="input" />
              </div>
            </div>

            <div class="field">
              <label class="label-xs">å‚™è¨»</label>
              <input id="replaceAddNote" class="input" />
            </div>

            <div class="grid md:grid-cols-5 gap-3">
              <div class="field">
                <label class="label-xs">æ‰¹é‡ç­†æ•¸ï¼ˆå¦‚ä¸æ‰¹é‡ç•™ç©ºï¼‰</label>
                <input id="replaceAddBatch" type="number" class="input" />
              </div>
            </div>

            <div class="flex justify-end gap-2">
              <button class="btn btn-ghost" onclick="toggleReplaceAdd(false)">å–æ¶ˆ</button>
              <button class="btn btn-primary" onclick="submitReplacementLog()">æäº¤</button>
            </div>
          </div>

          <!-- è¡¨æ ¼ -->
          <div class="overflow-auto">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
              <tr>
                <th class="py-2 pr-4">æ—¥æœŸ</th>
                <th class="py-2 pr-4">æ²»å…·</th>
                <th class="py-2 pr-4">åŸå› </th>
                <th class="py-2 pr-4">åŸ·è¡Œäººå“¡</th>
                <th class="py-2 pr-4">å‚™è¨»</th>
                <th class="py-2 pr-4">åˆªé™¤</th>
              </tr>
              </thead>
              <tbody id="replaceTable"></tbody>
            </table>
          </div>

        </div>
      </div>

    </section>


    <!-- å¾Œå°ç®¡ç†(æ–°å¢:å­é å±¤) -->
    <section id="tab-admin" class="hidden space-y-4">
      <!-- å­é å±¤ -->
      <div class="flex flex-wrap gap-2">
        <button class="tab subtab-active" data-subtab="acct">å¸³è™Ÿèˆ‡æ¬Šé™</button>
        <button class="tab" data-subtab="smtp">SMTP è¨­å®š</button>
        <button class="tab" data-subtab="fixture">æ²»å…·è³‡æ–™ç¶­è­·</button>
        <button class="tab" data-subtab="model">æ©Ÿç¨®è³‡æ–™ç¶­è­·</button>
      </div>

      <!-- å¸³è™Ÿèˆ‡æ¬Šé™ -->
      <div id="subtab-acct" class="card p-5 space-y-4">
        <h3 class="font-semibold">å¸³è™Ÿèˆ‡æ¬Šé™</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <!-- æ–°å¢å¸³æˆ¶ -->
          <div class="border rounded-2xl p-4 space-y-3">
            <div class="font-semibold text-sm">æ–°å¢å¸³æˆ¶</div>
            <div class="grid gap-3">
              <div class="field"><label class="label-xs">å¸³è™Ÿ (id)</label><input id="accAddId" class="input"/></div>
              <div class="field"><label class="label-xs">å¯†ç¢¼</label><input id="accAddPwd" type="password" class="input"/></div>
              <div class="field"><label class="label-xs">Email</label><input id="accAddMail" type="email" class="input"/></div>
              <div class="field"><label class="label-xs">æ¬Šé™</label>
                <select id="accAddRole" class="input">
                  <option value="user">ä¸€èˆ¬ç”¨æˆ¶(æŸ¥è©¢/å¢åŠ )</option>
                  <option value="admin">ç®¡ç†å“¡(æŸ¥è©¢/å¢ä¿®åˆª)</option>
                </select>
              </div>
              <button class="btn btn-primary" onclick="toast('å·²æ–°å¢å¸³æˆ¶(æ¨¡æ“¬)')">æ–°å¢</button>
            </div>
          </div>

          <!-- åˆªé™¤å¸³æˆ¶ -->
          <div class="border rounded-2xl p-4 space-y-3">
            <div class="font-semibold text-sm">åˆªé™¤å¸³æˆ¶</div>
            <div class="grid gap-3">
              <div class="field"><label class="label-xs">å¸³è™Ÿ (id)</label><input id="accDelId" class="input"/></div>
              <div class="field"><label class="label-xs">å¯†ç¢¼</label><input id="accDelPwd" type="password" class="input"/></div>
              <button class="btn btn-ghost" onclick="toast('å·²åˆªé™¤å¸³æˆ¶(æ¨¡æ“¬)')">åˆªé™¤</button>
            </div>
          </div>

          <!-- ä¿®æ”¹å¯†ç¢¼ -->
          <div class="border rounded-2xl p-4 space-y-3">
            <div class="font-semibold text-sm">ä¿®æ”¹å¯†ç¢¼</div>
            <div class="grid gap-3">
              <div class="field"><label class="label-xs">å¸³è™Ÿ (id)</label><input id="accModId" class="input"/></div>
              <div class="field"><label class="label-xs">ç¾è¡Œå¯†ç¢¼</label><input id="accModPwd" type="password" class="input"/></div>
              <div class="field"><label class="label-xs">æ–°å¯†ç¢¼</label><input id="accModNew" type="password" class="input"/></div>
              <div class="field"><label class="label-xs">Email</label><input id="accModMail" type="email" class="input"/></div>
              <button class="btn btn-ghost" onclick="toast('å·²ä¿®æ”¹å¯†ç¢¼(æ¨¡æ“¬)')">ä¿®æ”¹</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SMTP è¨­å®š(å«æ›´æ›é€šçŸ¥å°è±¡) -->
      <div id="subtab-smtp" class="card p-5 space-y-4 hidden">
        <h3 class="font-semibold">SMTP è¨­å®š</h3>
        <div class="grid md:grid-cols-3 gap-3">
          <div class="field"><label class="label-xs">Email</label><input id="smtpEmail" class="input" placeholder="é€šçŸ¥å¯„é€ Email"/></div>
          <div class="field"><label class="label-xs">å¤–é€éƒµä»¶ä¼ºæœå™¨åç¨± (SMTP)</label><input id="smtpHost" class="input" placeholder="smtp.example.com"/></div>
          <div class="field"><label class="label-xs">åŸ è™Ÿ (Port)</label><input id="smtpPort" class="input" placeholder="587"/></div>
          <div class="field"><label class="label-xs">èªè­‰ç‹€æ…‹</label>
            <select id="smtpAuthState" class="input">
              <option>æœªèªè­‰</option><option>å·²èªè­‰</option>
            </select>
          </div>
          <div class="field"><label class="label-xs">èªè­‰å¸³è™Ÿ</label><input id="smtpUser" class="input" /></div>
          <div class="field"><label class="label-xs">èªè­‰å¯†ç¢¼</label><input id="smtpPass" type="password" class="input" /></div>
          <div class="field"><label class="label-xs">å¯„ä»¶è€…åç¨±</label><input id="smtpSenderName" class="input" /></div>
          <div class="field"><label class="label-xs">å¯„ä»¶è€…ä¿¡ç®±</label><input id="smtpSenderMail" type="email" class="input" /></div>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-primary" onclick="toast('å·²å„²å­˜ SMTP(æ¨¡æ“¬)')">å„²å­˜</button>
          <button class="btn btn-ghost" onclick="toast('æ¸¬è©¦å¯„ä¿¡(æ¨¡æ“¬)')">æ¸¬è©¦å¯„ä¿¡</button>
        </div>

        <div class="pt-2 border-t">
          <div class="flex items-center justify-between py-3">
            <h4 class="font-semibold">æ›´æ›é€šçŸ¥å°è±¡</h4>
            <button class="btn btn-ghost" onclick="downloadCSV('owners.csv', toCSV(mockOwners))">åŒ¯å‡ºè² è²¬äºº</button>
          </div>
          <div class="overflow-auto">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
                <tr><th class="py-2 pr-4">å“¡ç·¨</th><th class="py-2 pr-4">å§“å</th><th class="py-2 pr-4">Email</th><th class="py-2 pr-4">æ“ä½œ</th></tr>
              </thead>
              <tbody id="ownerTable"></tbody>
            </table>
          </div>
        </div>
      </div>

            <!-- æ²»å…·è³‡æ–™ç¶­è­· -->
      <div id="subtab-fixture" class="card p-5 space-y-3 hidden">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">æ²»å…·è³‡æ–™ç¶­è­·</h3>
          <div class="flex items-center gap-2">
            <button class="btn btn-ghost" onclick="exportFixturesCsv()">åŒ¯å‡º</button>
            <button class="btn btn-ghost" onclick="downloadCSV('fixtures_template.csv', fixtureTemplate())">ä¸‹è¼‰ç¯„æœ¬</button>
            <label class="btn btn-ghost cursor-pointer">
              <input id="fxCsv" type="file" accept=".xlsx,.csv" class="hidden" onchange="handleFixtureCsv(this)" />
              åŒ¯å…¥ Excel/CSV
            </label>
            <button class="btn btn-primary" onclick="openFixtureModal('create')">æ–°å¢æ²»å…·</button>
          </div>
        </div>

        <!-- ç¯©é¸æ¢ä»¶ -->
        <div class="grid md:grid-cols-5 gap-3">
          <div class="field">
            <label class="label-xs">é—œéµå­—</label>
            <input id="fxSearch" class="input" placeholder="æ²»å…·ç·¨è™Ÿ / åç¨±" onkeydown="if(event.key==='Enter'){fxPage=1;loadFixtureList();}" />
          </div>
          <div class="field">
            <label class="label-xs">ç‹€æ…‹</label>
            <select id="fxStatusFilter" class="input" onchange="fxPage=1;loadFixtureList();">
              <option value="">å…¨éƒ¨</option>
              <option value="æ­£å¸¸">æ­£å¸¸</option>
              <option value="è¿”é‚„">è¿”é‚„</option>
              <option value="å ±å»¢">å ±å»¢</option>
            </select>
          </div>
          <div class="field">
            <label class="label-xs">è² è²¬äºº (owner_id)</label>
            <input id="fxOwnerFilter" class="input" placeholder="ID (é¸å¡«ï¼Œå¯ç•™ç©º)" onkeydown="if(event.key==='Enter'){fxPage=1;loadFixtureList();}" />
          </div>
          <div class="field">
            <label class="label-xs">æ¯é ç­†æ•¸</label>
            <select id="fxPageSize" class="input" onchange="fxPage=1;loadFixtureList();">
              <option value="8">8</option>
              <option value="20">20</option>
              <option value="50">50</option>
            </select>
          </div>
          <div class="field flex items-end">
            <button class="btn btn-ghost w-full" onclick="fxPage=1;loadFixtureList();">é‡æ–°æ•´ç†</button>
          </div>
        </div>

        <!-- åˆ—è¡¨ + åˆ†é  -->
        <div class="border-t pt-3">
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-600">
              å…± <span id="fxCount">0</span> ç­†ï¼Œ
              é¡¯ç¤ºç¬¬ <span id="fxPageNow">1</span> / <span id="fxPageMax">1</span> é 
            </div>
            <div class="pagination flex items-center gap-2">
              <button class="btn btn-ghost text-xs" onclick="goFixturePage('first')">Â«</button>
              <button class="btn btn-ghost text-xs" onclick="goFixturePage('prev')">ä¸Šä¸€é </button>
              <button class="btn btn-ghost text-xs" onclick="goFixturePage('next')">ä¸‹ä¸€é </button>
              <button class="btn btn-ghost text-xs" onclick="goFixturePage('last')">Â»</button>
            </div>
          </div>

          <div class="overflow-auto mt-2">
            <table class="min-w-full text-xs md:text-sm">
              <thead class="text-left text-gray-500">
                <tr>
                  <th class="py-2 pr-4">æ²»å…·ç·¨è™Ÿ</th>
                  <th class="py-2 pr-4">æ²»å…·åç¨±</th>
                  <th class="py-2 pr-4">é¡å‹</th>
                  <th class="py-2 pr-4">è‡ªè³¼ / å®¢ä¾› / ç¸½æ•¸</th>
                  <th class="py-2 pr-4">å„²ä½</th>
                  <th class="py-2 pr-4">ç‹€æ…‹</th>
                  <th class="py-2 pr-4">æ›´æ›é€±æœŸ</th>
                  <th class="py-2 pr-4">è² è²¬äºº</th>
                  <th class="py-2 pr-4">å‚™è¨»</th>
                  <th class="py-2 pr-4">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="fxTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- æ²»å…· æ–°å¢/ç·¨è¼¯ Modal -->
      <div id="fixtureModal" class="fixed inset-0 bg-black/30 backdrop-blur-sm items-center justify-center hidden z-40">
        <div class="bg-white rounded-2xl shadow-xl max-w-3xl w-full mx-4 p-5 space-y-4">
          <div class="flex items-center justify-between">
            <h3 id="fixtureModalTitle" class="font-semibold text-lg">æ–°å¢æ²»å…·</h3>
            <button class="btn btn-ghost text-sm" onclick="closeFixtureModal()">âœ•</button>
          </div>

          <form id="fixtureForm" class="space-y-3" onsubmit="submitFixtureForm(event)">
            <div class="grid md:grid-cols-3 gap-3">
              <div class="field">
                <label class="label-xs">æ²»å…·ç·¨è™Ÿ (fixture_id)</label>
                <input id="fmFixtureId" class="input" placeholder="L-00017" />
              </div>
              <div class="field">
                <label class="label-xs">æ²»å…·åç¨±</label>
                <input id="fmFixtureName" class="input" placeholder="ä¸»æ¿æ¸¬è©¦æ²»å…· A" />
              </div>
              <div class="field">
                <label class="label-xs">æ²»å…·é¡å‹</label>
                <input id="fmFixtureType" class="input" placeholder="æ¸¬è©¦æ²»å…·" />
              </div>
            </div>

            <div class="grid md:grid-cols-4 gap-3">
              <div class="field">
                <label class="label-xs">åºè™Ÿ (serial_number)</label>
                <input id="fmSerialNumber" class="input" placeholder="SN2025..." />
              </div>
              <div class="field">
                <label class="label-xs">è‡ªè³¼æ•¸é‡</label>
                <input id="fmSelfQty" type="number" min="0" class="input" />
              </div>
              <div class="field">
                <label class="label-xs">å®¢ä¾›æ•¸é‡</label>
                <input id="fmCustomerQty" type="number" min="0" class="input" />
              </div>
              <div class="field">
                <label class="label-xs">å„²å­˜ä½ç½®</label>
                <input id="fmStorage" class="input" placeholder="å€‰åº« A-01" />
              </div>
            </div>

            <div class="grid md:grid-cols-4 gap-3">
              <div class="field">
                <label class="label-xs">æ›´æ›é€±æœŸ (æ•¸å€¼)</label>
                <input id="fmCycle" type="number" min="0" step="0.01" class="input" />
              </div>
              <div class="field">
                <label class="label-xs">é€±æœŸå–®ä½ (cycle_unit)</label>
                <select id="fmCycleUnit" class="input">
                  <option value="uses">ä½¿ç”¨æ¬¡æ•¸</option>
                  <option value="days">å¤©æ•¸</option>
                  <option value="none">ç„¡</option>
                </select>
              </div>
              <div class="field">
                <label class="label-xs">ç‹€æ…‹</label>
                <select id="fmStatus" class="input">
                  <option value="æ­£å¸¸">æ­£å¸¸</option>
                  <option value="è¿”é‚„">è¿”é‚„</option>
                  <option value="å ±å»¢">å ±å»¢</option>
                </select>
              </div>
              <div class="field">
                <label class="label-xs">è² è²¬äºº ID (owner_id)</label>
                <input id="fmOwnerId" type="number" min="0" class="input" />
              </div>
            </div>

            <div class="field">
              <label class="label-xs">å‚™è¨»</label>
              <textarea id="fmNote" class="input" rows="2"></textarea>
            </div>

            <div class="flex items-center justify-end gap-2 pt-2 border-t">
              <button type="button" class="btn btn-ghost" onclick="closeFixtureModal()">å–æ¶ˆ</button>
              <button type="submit" class="btn btn-primary">å„²å­˜</button>
            </div>
          </form>
        </div>
      </div>


      <!-- æ©Ÿç¨®è³‡æ–™ç¶­è­· -->
      <div id="subtab-model" class="card p-5 space-y-3 hidden">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">æ©Ÿç¨®è³‡æ–™ç¶­è­·</h3>
          <div class="flex items-center gap-2">
            <button class="btn btn-ghost" onclick="downloadCSV('models_export.csv', toCSV(mockModels))">åŒ¯å‡º</button>
            <button class="btn btn-ghost" onclick="downloadCSV('models_template.csv', modelTemplate())">ä¸‹è¼‰ç¯„æœ¬</button>
          </div>
        </div>
        <div class="grid md:grid-cols-4 gap-3">
          <div class="field"><label class="label-xs">æ²»å…·åç¨±</label><input id="mdFxName" class="input" placeholder="å°æ‡‰æ²»å…·åç¨±" /></div>
          <div class="field"><label class="label-xs">å°æ‡‰ä½¿ç”¨æ©Ÿç¨®</label><input id="mdModelName" class="input" placeholder="æ©Ÿç¨®åç¨±" /></div>
          <div class="field"><label class="label-xs">ç«™é»</label><input id="mdPos" class="input" placeholder="ç«™é»/ä½ç½®" /></div>
          <div class="field"><label class="label-xs">æ•¸é‡</label><input id="mdQty" type="number" class="input" placeholder="æ•¸é‡" /></div>
        </div>
        <div class="flex items-center gap-2">
          <button class="btn btn-primary" onclick="addModel()">æ–°å¢</button>
          <label class="btn btn-ghost cursor-pointer"><input id="mdCsv" type="file" accept=".xlsx,.csv" class="hidden" onchange="handleModelCsv(this)" /> åŒ¯å…¥ Excel/CSV</label>
        </div>
        <div class="border-t pt-3">
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-600">å…± <span id="mdCount">0</span> ç­†</div>
            <div class="pagination flex items-center gap-2">
              <button class="btn btn-ghost text-xs" id="mdFirst" onclick="mdPage=1; renderModelList()">Â«</button>
              <button class="btn btn-ghost text-xs" id="mdPrev"  onclick="mdPage=Math.max(1,mdPage-1); renderModelList()">ä¸Šä¸€é </button>
              <span class="text-xs">ç¬¬ <span id="mdPageNow">1</span> / <span id="mdPageMax">1</span> é (æ¯é  8 ç­†)</span>
              <button class="btn btn-ghost text-xs" id="mdNext"  onclick="mdPage=Math.min(mdTotalPages,mdPage+1); renderModelList()">ä¸‹ä¸€é </button>
              <button class="btn btn-ghost text-xs" id="mdLast"  onclick="mdPage=mdTotalPages; renderModelList()">Â»</button>
            </div>
          </div>
          <div class="overflow-auto mt-2">
            <table class="min-w-full text-sm">
              <thead class="text-left text-gray-500">
                <tr><th class="py-2 pr-4">æ²»å…·åç¨±</th><th class="py-2 pr-4">æ©Ÿç¨®</th><th class="py-2 pr-4">ç«™é»</th><th class="py-2 pr-4">æ•¸é‡</th><th class="py-2 pr-4">æ“ä½œ</th></tr>
              </thead>
              <tbody id="mdTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden">
    <div class="bg-gray-900 text-white px-4 py-2 rounded-xl shadow-lg">è¨Šæ¯</div>
  </div>

    <!-- å¼•å…¥ JavaScript -->
<!-- ================================ -->
<!-- ğŸ’¡ åŸºç¤æ ¸å¿ƒï¼šå¿…é ˆæœ€å…ˆè¼‰å…¥        -->
<!-- ================================ -->

<!-- Excel åŒ¯å…¥ï¼ˆå¿…é ˆæœ€ä¸Šï¼Œä»¥ä¾¿å¾ŒçºŒæ‰€æœ‰åŒ¯å…¥åŠŸèƒ½ä½¿ç”¨ï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<!-- API åŸºæœ¬è¨­å®šï¼Œå¦‚ api()ã€API_PREFIX ç­‰ -->
<script src="/web/js/api-config.js"></script>

<!-- å…±é€šå·¥å…·ã€LocalStorageã€UI å·¥å…·ã€è¨ˆç®—é‚è¼¯ -->
<script src="/web/js/storage.js"></script>
<script src="/web/js/utils.js"></script>
<script src="/web/js/calculations.js"></script>
<script src="/web/js/ui-render.js"></script>


<!-- ================================ -->
<!-- ğŸ” ä½¿ç”¨è€…ç™»å…¥èªè­‰ / å¸³æˆ¶ç®¡ç†      -->
<!-- ================================ -->

<script src="/web/js/auth.js"></script>
<script src="/web/js/api-users.js"></script>
<script src="/web/js/admin.js"></script>
<script src="/web/js/api-stats-auth.js"></script>


<!-- ================================ -->
<!-- ğŸ§± åŸºç¤è³‡æ–™ï¼ˆæ²»å…· Fixturesï¼‰      -->
<!-- ================================ -->

<script src="/web/js/api-fixtures.js"></script>


<!-- ================================ -->
<!-- ğŸ“¦ æ”¶æ–™ / é€€æ–™ï¼ˆæ–°æ‹†åˆ†çš„å…©é ï¼‰     -->
<!-- ================================ -->

<!-- ä½ çš„åŸæœ‰ api-receipts.jsï¼ˆå·²ç¶“åŠ  Excel è§£è®€ï¼‰ -->
<script src="/web/js/api-receipts.js"></script>

<!-- æ–°å¢ï¼šé€€æ–™ API -->
<script src="/web/js/api-returns.js"></script>

<!-- æ–°å¢ï¼šå‰ç«¯ UI æ§åˆ¶ï¼ˆæ”¶æ–™ï¼‰ -->
<script src="/web/js/app-receipts.js"></script>

<!-- æ–°å¢ï¼šå‰ç«¯ UI æ§åˆ¶ï¼ˆé€€æ–™ï¼‰ -->
<script src="/web/js/app-returns.js"></script>


<!-- ================================ -->
<!-- ğŸ”§ ä½¿ç”¨ / æ›´æ› è¨˜éŒ„               -->
<!-- ================================ -->

<!-- ä½¿ç”¨è¨˜éŒ„ API -->
<script src="/web/js/api-usage.js"></script>

<!-- æ›´æ›è¨˜éŒ„ API -->
<script src="/web/js/api-replacement.js"></script>

<!-- ä½¿ç”¨/æ›´æ› è¨˜éŒ„çš„ UI æ§åˆ¶ç¨‹å¼ -->
<script src="/web/js/app-logs.js"></script>


<!-- ================================ -->
<!-- ğŸ  ä¸»æ§åˆ¶ï¼ˆé é¢åˆ‡æ›/åˆå§‹åŒ–ï¼‰       -->
<!-- ================================ -->
<script src="/web/js/app-main.js"></script>


<!-- ================================ -->
<!-- ğŸš€ åˆå§‹åŒ–ï¼ˆå¯é¸ï¼Œå»ºè­°åŠ ï¼‰         -->
<!-- ================================ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // è‡ªå‹•è¼‰å…¥å„è¡¨æ ¼ï¼ˆé¿å…ç©ºç™½é ï¼‰
  if (typeof loadUsageLogs === 'function') loadUsageLogs();
  if (typeof loadReplacementLogs === 'function') loadReplacementLogs();
  if (typeof loadReceipts === 'function') loadReceipts();
  if (typeof loadReturns === 'function') loadReturns();
});
</script>


</body>
</html>